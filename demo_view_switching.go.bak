// Demo program to demonstrate view switching functionality
// æ¼”ç¤ºè¦–åœ–åˆ‡æ›åŠŸèƒ½çš„ç¤ºä¾‹ç¨‹å¼
package main

import (
	"fmt"
	"fyne.io/fyne/v2"
	"fyne.io/fyne/v2/app"
	"fyne.io/fyne/v2/container"
	"fyne.io/fyne/v2/widget"
	"mac-notebook-app/ui"
)

func main() {
	// å»ºç«‹æ‡‰ç”¨ç¨‹å¼
	myApp := app.NewWithID("view-switching-demo")
	myWindow := myApp.NewWindow("è¦–åœ–åˆ‡æ›åŠŸèƒ½æ¼”ç¤º")
	myWindow.Resize(fyne.NewSize(1200, 800))

	// å»ºç«‹ä½ˆå±€ç®¡ç†å™¨
	layoutManager := ui.NewLayoutManager()

	// å»ºç«‹è¦–åœ–ç®¡ç†å™¨
	viewManager := ui.NewViewManager(myWindow, layoutManager)

	// å»ºç«‹ç¤ºä¾‹å…§å®¹
	editorContent := container.NewVBox(
		widget.NewLabel("ğŸ“ ç·¨è¼¯å™¨å…§å®¹"),
		widget.NewEntry(),
		widget.NewButton("æ¨¡æ“¬ç·¨è¼¯æ“ä½œ", func() {
			fmt.Println("åŸ·è¡Œç·¨è¼¯æ“ä½œ")
		}),
	)

	previewContent := container.NewVBox(
		widget.NewLabel("ğŸ‘ï¸ é è¦½å…§å®¹"),
		widget.NewRichTextFromMarkdown("# ç¤ºä¾‹æ¨™é¡Œ\n\né€™æ˜¯ **Markdown** é è¦½å…§å®¹ã€‚\n\n- é …ç›® 1\n- é …ç›® 2\n- é …ç›® 3"),
		widget.NewButton("æ¨¡æ“¬é è¦½æ“ä½œ", func() {
			fmt.Println("åŸ·è¡Œé è¦½æ“ä½œ")
		}),
	)

	// è¨­å®šå…§å®¹åˆ°è¦–åœ–ç®¡ç†å™¨
	viewManager.SetEditorContent(editorContent)
	viewManager.SetPreviewContent(previewContent)

	// å»ºç«‹æ§åˆ¶é¢æ¿
	controlPanel := container.NewVBox(
		widget.NewLabel("ğŸ›ï¸ è¦–åœ–æ§åˆ¶é¢æ¿"),
		widget.NewSeparator(),
		
		// è¦–åœ–æ¨¡å¼åˆ‡æ›æŒ‰éˆ•
		widget.NewButton("ğŸ“ ç·¨è¼¯æ¨¡å¼ (âŒ˜1)", func() {
			viewManager.SetViewMode(ui.ViewModeEdit)
			fmt.Println("åˆ‡æ›åˆ°ç·¨è¼¯æ¨¡å¼")
		}),
		widget.NewButton("ğŸ‘ï¸ é è¦½æ¨¡å¼ (âŒ˜2)", func() {
			viewManager.SetViewMode(ui.ViewModePreview)
			fmt.Println("åˆ‡æ›åˆ°é è¦½æ¨¡å¼")
		}),
		widget.NewButton("âš¡ åˆ†å‰²è¦–åœ– (âŒ˜3)", func() {
			viewManager.SetViewMode(ui.ViewModeSplit)
			fmt.Println("åˆ‡æ›åˆ°åˆ†å‰²è¦–åœ–")
		}),
		
		widget.NewSeparator(),
		
		// å…¶ä»–æ§åˆ¶åŠŸèƒ½
		widget.NewButton("ğŸ”„ å¾ªç’°åˆ‡æ›", func() {
			viewManager.ToggleViewMode()
			mode := viewManager.GetCurrentViewModeString()
			fmt.Printf("å¾ªç’°åˆ‡æ›åˆ°ï¼š%s\n", mode)
		}),
		widget.NewButton("ğŸ”™ è¿”å›ä¸Šä¸€å€‹æ¨¡å¼", func() {
			viewManager.RestorePreviousMode()
			mode := viewManager.GetCurrentViewModeString()
			fmt.Printf("è¿”å›åˆ°ï¼š%s\n", mode)
		}),
		widget.NewButton("ğŸ–¥ï¸ åˆ‡æ›å…¨è¢å¹• (âŒƒâŒ˜F)", func() {
			viewManager.ToggleFullscreen()
			if viewManager.IsFullscreen() {
				fmt.Println("é€²å…¥å…¨è¢å¹•æ¨¡å¼")
			} else {
				fmt.Println("é€€å‡ºå…¨è¢å¹•æ¨¡å¼")
			}
		}),
		
		widget.NewSeparator(),
		
		// åˆ†å‰²æ¯”ä¾‹æ§åˆ¶
		widget.NewLabel("åˆ†å‰²æ¯”ä¾‹æ§åˆ¶ï¼š"),
		func() *widget.Slider {
			slider := widget.NewSlider(0.1, 0.9)
			slider.Value = 0.5
			slider.OnChanged = func(value float64) {
				viewManager.SetSplitRatio(value)
				fmt.Printf("è¨­å®šåˆ†å‰²æ¯”ä¾‹ï¼š%.2f\n", value)
			}
			return slider
		}(),
	)

	// è¨­å®šå›èª¿å‡½æ•¸ä¾†é¡¯ç¤ºç‹€æ…‹è®Šæ›´
	viewManager.SetOnViewModeChanged(func(mode ui.ViewMode) {
		modeString := viewManager.GetViewModeString(mode)
		fmt.Printf("âœ… è¦–åœ–æ¨¡å¼å·²è®Šæ›´ç‚ºï¼š%s\n", modeString)
	})

	viewManager.SetOnFullscreenToggled(func(fullscreen bool) {
		if fullscreen {
			fmt.Println("âœ… å·²é€²å…¥å…¨è¢å¹•æ¨¡å¼")
		} else {
			fmt.Println("âœ… å·²é€€å‡ºå…¨è¢å¹•æ¨¡å¼")
		}
	})

	viewManager.SetOnSplitRatioChanged(func(ratio float64) {
		fmt.Printf("âœ… åˆ†å‰²æ¯”ä¾‹å·²è®Šæ›´ç‚ºï¼š%.2f\n", ratio)
	})

	// å»ºç«‹ç‹€æ…‹é¡¯ç¤º
	statusLabel := widget.NewLabel("ç•¶å‰ç‹€æ…‹ï¼šåˆ†å‰²è¦–åœ–")
	
	// æ›´æ–°ç‹€æ…‹é¡¯ç¤ºçš„å‡½æ•¸
	updateStatus := func() {
		mode := viewManager.GetCurrentViewModeString()
		ratio := viewManager.GetSplitRatio()
		fullscreen := ""
		if viewManager.IsFullscreen() {
			fullscreen = " (å…¨è¢å¹•)"
		}
		statusLabel.SetText(fmt.Sprintf("ç•¶å‰ç‹€æ…‹ï¼š%s%s | åˆ†å‰²æ¯”ä¾‹ï¼š%.2f", mode, fullscreen, ratio))
	}

	// è¨­å®šå®šæ™‚æ›´æ–°ç‹€æ…‹
	viewManager.SetOnViewModeChanged(func(mode ui.ViewMode) {
		modeString := viewManager.GetViewModeString(mode)
		fmt.Printf("âœ… è¦–åœ–æ¨¡å¼å·²è®Šæ›´ç‚ºï¼š%s\n", modeString)
		updateStatus()
	})

	viewManager.SetOnFullscreenToggled(func(fullscreen bool) {
		if fullscreen {
			fmt.Println("âœ… å·²é€²å…¥å…¨è¢å¹•æ¨¡å¼")
		} else {
			fmt.Println("âœ… å·²é€€å‡ºå…¨è¢å¹•æ¨¡å¼")
		}
		updateStatus()
	})

	viewManager.SetOnSplitRatioChanged(func(ratio float64) {
		fmt.Printf("âœ… åˆ†å‰²æ¯”ä¾‹å·²è®Šæ›´ç‚ºï¼š%.2f\n", ratio)
		updateStatus()
	})

	// çµ„åˆä¸»è¦ä½ˆå±€
	mainContent := container.NewHSplit(
		controlPanel,
		viewManager.GetContainer(),
	)
	mainContent.Offset = 0.25 // æ§åˆ¶é¢æ¿ä½” 25%

	// å»ºç«‹å®Œæ•´ä½ˆå±€
	fullLayout := container.NewVBox(
		statusLabel,
		widget.NewSeparator(),
		mainContent,
	)

	// è¨­å®šè¦–çª—å…§å®¹
	myWindow.SetContent(fullLayout)

	// åˆå§‹åŒ–ç‹€æ…‹é¡¯ç¤º
	updateStatus()

	// é¡¯ç¤ºèªªæ˜
	fmt.Println("ğŸ‰ è¦–åœ–åˆ‡æ›åŠŸèƒ½æ¼”ç¤ºç¨‹å¼å·²å•Ÿå‹•ï¼")
	fmt.Println("ğŸ“‹ åŠŸèƒ½èªªæ˜ï¼š")
	fmt.Println("   - ä½¿ç”¨å·¦å´æ§åˆ¶é¢æ¿çš„æŒ‰éˆ•ä¾†åˆ‡æ›è¦–åœ–æ¨¡å¼")
	fmt.Println("   - æ”¯æ´éµç›¤å¿«æ·éµï¼šâŒ˜1 (ç·¨è¼¯)ã€âŒ˜2 (é è¦½)ã€âŒ˜3 (åˆ†å‰²)ã€âŒƒâŒ˜F (å…¨è¢å¹•)")
	fmt.Println("   - å¯ä»¥èª¿æ•´åˆ†å‰²æ¯”ä¾‹æ»‘æ¡¿ä¾†æ”¹è®Šç·¨è¼¯å™¨å’Œé è¦½çš„æ¯”ä¾‹")
	fmt.Println("   - æ‰€æœ‰æ“ä½œéƒ½æœƒåœ¨çµ‚ç«¯é¡¯ç¤ºç‹€æ…‹è¨Šæ¯")
	fmt.Println("")

	// é¡¯ç¤ºè¦–çª—ä¸¦é‹è¡Œ
	myWindow.ShowAndRun()
}